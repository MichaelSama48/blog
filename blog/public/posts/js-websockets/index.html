<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Khi Web Không Chỉ Là Tĩnh Lặng: Đánh Thức Sự Sống Với WebSockets | Blog của Hoàng Anh</title>
<meta name="keywords" content="JavaScript, Socket.io, Real-time, Storytelling">
<meta name="description" content="Tại sao Facebook biết bạn có tin nhắn mới ngay lập tức mà không cần F5? Bí mật đằng sau những ứng dụng Real-time và sự thay thế hoàn hảo cho HTTP truyền thống.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/js-websockets/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fd5566c526ae48aadabd950798a2dc3568536401560eae5caac3765a42a9e7b5.css" integrity="sha256-/VVmxSauSKravZUHmKLcNWhTZAFWDq5cqsN2WkKp57U=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/js-websockets/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Blog của Hoàng Anh (Alt + H)">Blog của Hoàng Anh</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts" title="Blog (Bài viết)">
                    <span>Blog (Bài viết)</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Khi Web Không Chỉ Là Tĩnh Lặng: Đánh Thức Sự Sống Với WebSockets
    </h1>
    <div class="post-description">
      Tại sao Facebook biết bạn có tin nhắn mới ngay lập tức mà không cần F5? Bí mật đằng sau những ứng dụng Real-time và sự thay thế hoàn hảo cho HTTP truyền thống.
    </div>
    <div class="post-meta"><span title='2024-06-12 00:00:00 +0000 UTC'>June 12, 2024</span>&nbsp;·&nbsp;<span>6 min</span>

</div>
  </header> 
<figure class="entry-cover">
        <img loading="eager" src="http://localhost:1313/images/web-socket.jpg" alt="Abstract Network Nodes">
        <figcaption>Mạng lưới kết nối sống động.</figcaption>
</figure>
  <div class="post-content"><h2 id="http-truyền-thống-và-bài-toán-thời-gian-thực">HTTP truyền thống và bài toán thời gian thực<a hidden class="anchor" aria-hidden="true" href="#http-truyền-thống-và-bài-toán-thời-gian-thực">#</a></h2>
<p>Khi mới bắt đầu làm ứng dụng chat, điều đầu tiên nghĩ đến là dùng HTTP yêu cầu-phản hồi thông thường. Client cứ 2 giây lại gửi một yêu cầu lên server hỏi “có tin nhắn mới không?”. Server trả về danh sách tin nhắn mới nếu có, hoặc trả về mảng rỗng nếu không. Nghe có vẻ hợp lý, nhưng khi chạy thực tế thì thấy ngay vấn đề.</p>
<p>HTTP được thiết kế theo mô hình <strong>yêu cầu-phản hồi</strong>. Client phải khởi tạo mọi giao tiếp. Server không thể tự ý gửi dữ liệu xuống client khi có sự kiện mới. Điều này hoàn toàn ổn với website thông thường, nhưng với ứng dụng thời gian thực như chat, thông báo, bảng điều khiển trực tiếp thì lại là một vấn đề lớn. Người dùng gửi tin nhắn đến, nhưng phải đợi đến khi client gửi yêu cầu tiếp theo mới nhận được. Độ trễ này có thể từ vài trăm mili giây đến vài giây tùy thuộc vào khoảng thời gian thăm dò.</p>
<h3 id="http-polling---giải-pháp-tình-thế-đầu-tiên">HTTP Polling - Giải pháp tình thế đầu tiên<a hidden class="anchor" aria-hidden="true" href="#http-polling---giải-pháp-tình-thế-đầu-tiên">#</a></h3>
<p>HTTP Polling chính là cách vừa mô tả. Client liên tục gửi yêu cầu lên server theo một khoảng thời gian cố định, ví dụ mỗi 2 giây. Mỗi lần gửi yêu cầu, nó hỏi server “có cập nhật không?”. Nếu có dữ liệu mới, server trả về. Nếu không, server trả về phản hồi rỗng.</p>
<p>Vấn đề lớn nhất của thăm dò chính là <strong>chi phí phụ khủng khiếp</strong>. Mỗi yêu cầu HTTP bao gồm bắt tay TCP nếu kết nối không được tái sử dụng, các HTTP headers, và thời gian xử lý ở cả client lẫn server. Nếu có 10,000 người dùng và mỗi người thăm dò mỗi 2 giây, đó là <strong>5,000 yêu cầu mỗi giây</strong> đập vào server, trong khi 99% yêu cầu đó trả về phản hồi rỗng vì không có dữ liệu mới.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Client-side polling - cách làm tốn kém
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">startPolling</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">setInterval</span>(<span style="color:#66d9ef">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;/api/messages&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">messages</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">updateUI</span>(<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">messages</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }, <span style="color:#ae81ff">2000</span>); <span style="color:#75715e">// Thăm dò mỗi 2 giây
</span></span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Trường hợp thử nghiệm thăm dò cho một ứng dụng chat nhỏ với khoảng 100 người dùng đồng thời. Server CPU liên tục ở mức 40-50% chỉ để xử lý những yêu cầu không có gì.</p>
<h3 id="long-polling---cải-thiện-nhưng-vẫn-tạm-bợ">Long Polling - Cải thiện nhưng vẫn tạm bợ<a hidden class="anchor" aria-hidden="true" href="#long-polling---cải-thiện-nhưng-vẫn-tạm-bợ">#</a></h3>
<p>Long Polling ra đời như một cải tiến của Polling. Thay vì server trả về ngay lập tức, server giữ yêu cầu trong trạng thái chờ cho đến khi có dữ liệu mới hoặc hết thời gian chờ. Khi có sự kiện xảy ra, server mới phản hồi và đóng kết nối. Client nhận phản hồi, xử lý dữ liệu, rồi ngay lập tức tạo yêu cầu mới.</p>
<p>Cơ chế này giảm số lượng yêu cầu đáng kể so với thăm dò thông thường. Tuy nhiên, Long Polling vẫn có những hạn chế nghiêm trọng. Mỗi yêu cầu đang chờ chiếm giữ một thread hoặc kết nối ở server. Với mô hình một thread cho một yêu cầu như Java Servlets truyền thống, 10,000 người dùng đồng thời nghĩa là 10,000 threads đang chờ, tiêu tốn bộ nhớ và chi phí chuyển ngữ cảnh.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Server-side long polling với Java</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@WebServlet</span>(<span style="color:#e6db74">&#34;/api/messages&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessagesServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> TIMEOUT <span style="color:#f92672">=</span> 30000;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span>(HttpServletRequest req, HttpServletResponse resp) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> startTime <span style="color:#f92672">=</span> System.<span style="color:#a6e22e">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>Message<span style="color:#f92672">&gt;</span> messages <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Chờ cho đến khi có tin nhắn hoặc hết thời gian</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (System.<span style="color:#a6e22e">currentTimeMillis</span>() <span style="color:#f92672">-</span> startTime <span style="color:#f92672">&lt;</span> TIMEOUT) {
</span></span><span style="display:flex;"><span>            messages <span style="color:#f92672">=</span> messageQueue.<span style="color:#a6e22e">poll</span>(userId); <span style="color:#75715e">// Đây là giả định logic kiểm tra hàng đợi</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>messages.<span style="color:#a6e22e">isEmpty</span>()) <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> { Thread.<span style="color:#a6e22e">sleep</span>(100); } <span style="color:#66d9ef">catch</span> (InterruptedException e) {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        resp.<span style="color:#a6e22e">setContentType</span>(<span style="color:#e6db74">&#34;application/json&#34;</span>);
</span></span><span style="display:flex;"><span>        resp.<span style="color:#a6e22e">getWriter</span>().<span style="color:#a6e22e">write</span>(<span style="color:#66d9ef">new</span> Gson().<span style="color:#a6e22e">toJson</span>(messages));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="server-sent-events---một-chiều-nhưng-hiệu-quả">Server-Sent Events - Một chiều nhưng hiệu quả<a hidden class="anchor" aria-hidden="true" href="#server-sent-events---một-chiều-nhưng-hiệu-quả">#</a></h3>
<p>SSE (Server-Sent Events) là một bước tiến đáng kể. SSE cho phép server đẩy dữ liệu xuống client qua một kết nối HTTP duy nhất, bền vững. Khác với thăm dò, kết nối được giữ mở và server có thể gửi sự kiện bất kỳ lúc nào.</p>
<p>Điểm hay của SSE là nó vô cùng đơn giản. Client chỉ cần tạo một đối tượng <code>EventSource</code>, và server chỉ cần đặt header <code>Content-Type: text/event-stream</code>. Tuy nhiên, SSE có một hạn chế lớn: nó chỉ là <strong>giao tiếp một chiều</strong>. Server có thể đẩy dữ liệu xuống client, nhưng client muốn gửi dữ liệu lên server thì vẫn phải tạo yêu cầu HTTP riêng.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Client-side SSE - cực kỳ đơn giản
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">eventSource</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">EventSource</span>(<span style="color:#e6db74">&#34;/api/events&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">eventSource</span>.<span style="color:#a6e22e">onmessage</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">updateUI</span>(<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><h2 id="websocket---kết-nối-song-công-toàn-phần-thực-sự">WebSocket - Kết nối song công toàn phần thực sự<a hidden class="anchor" aria-hidden="true" href="#websocket---kết-nối-song-công-toàn-phần-thực-sự">#</a></h2>
<p>WebSocket là bước ngoặt. Thay vì lợi dụng HTTP để tạo ra kết nối bền vững, WebSocket thiết kế lại từ đầu cho giao tiếp thời gian thực. Nó bắt đầu như một yêu cầu HTTP, nhưng sau quá trình bắt tay thành công, kết nối được nâng cấp thành một socket TCP thuần túy.</p>
<p>Quá trình bắt tay của WebSocket khá thú vị. Client gửi một yêu cầu HTTP GET với header đặc biệt <code>Upgrade: websocket</code> và <code>Connection: Upgrade</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#a6e22e">GET</span> /chat <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">example.com</span>
</span></span><span style="display:flex;"><span>Upgrade<span style="color:#f92672">:</span> <span style="color:#ae81ff">websocket</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">Upgrade</span>
</span></span><span style="display:flex;"><span>Sec-WebSocket-Key<span style="color:#f92672">:</span> <span style="color:#ae81ff">dGhlIHNhbXBsZSBub25jZQ==</span>
</span></span><span style="display:flex;"><span>Sec-WebSocket-Version<span style="color:#f92672">:</span> <span style="color:#ae81ff">13</span>
</span></span></code></pre></div><p>Server phản hồi với <code>101 Switching Protocols</code>. Sau đó, giao thức HTTP chấm dứt. Kết nối TCP vẫn mở nhưng giờ dữ liệu được gửi theo giao thức đóng khung WebSocket. Không còn HTTP headers, không còn mô hình yêu cầu-phản hồi. Cả client và server đều có thể gửi dữ liệu bất kỳ lúc nào.</p>
<h3 id="code-ví-dụ-thực-tế">Code ví dụ thực tế<a hidden class="anchor" aria-hidden="true" href="#code-ví-dụ-thực-tế">#</a></h3>
<p>Dưới đây là cách triển khai WebSocket đơn giản và hiệu quả.</p>
<p><strong>Client-side (Trình duyệt):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ws</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WebSocket</span>(<span style="color:#e6db74">&#34;ws://localhost:8080/chat&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ws</span>.<span style="color:#a6e22e">onopen</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Đã kết nối&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ws</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;join&#34;</span>, <span style="color:#a6e22e">room</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;general&#34;</span> }));
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ws</span>.<span style="color:#a6e22e">onmessage</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">updateUI</span>(<span style="color:#a6e22e">message</span>);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Gửi tin nhắn đi mà không cần chờ đợi (non-blocking)
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sendMessage</span>(<span style="color:#a6e22e">text</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ws</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({ <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;message&#34;</span>, <span style="color:#a6e22e">text</span> }));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Server-side (Node.js với thư viện <code>ws</code>):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">WebSocket</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;ws&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">wss</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">WebSocket</span>.<span style="color:#a6e22e">Server</span>({ <span style="color:#a6e22e">port</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">8080</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">wss</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;connection&#34;</span>, (<span style="color:#a6e22e">ws</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;Client đã kết nối&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ws</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#34;message&#34;</span>, (<span style="color:#a6e22e">data</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">message</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Phát tới tất cả clients (Broadcast)
</span></span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">wss</span>.<span style="color:#a6e22e">clients</span>.<span style="color:#a6e22e">forEach</span>((<span style="color:#a6e22e">client</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">readyState</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">WebSocket</span>.<span style="color:#a6e22e">OPEN</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">send</span>(<span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">user</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">text</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">text</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">timestamp</span><span style="color:#f92672">:</span> Date.<span style="color:#a6e22e">now</span>(),
</span></span><span style="display:flex;"><span>        }));
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="so-sánh-hiệu-năng-và-lời-kết">So sánh hiệu năng và Lời kết<a hidden class="anchor" aria-hidden="true" href="#so-sánh-hiệu-năng-và-lời-kết">#</a></h2>
<p>Khi đặt ba cơ chế lên bàn cân, WebSocket thắng áp đảo về mặt hiệu quả cho các ứng dụng tương tác hai chiều.</p>
<ul>
<li><strong>HTTP Polling</strong>: Tốn kém nhất, độ trễ cao, lãng phí tài nguyên server và băng thông (do gửi header lặp lại).</li>
<li><strong>Long Polling</strong>: Tốt hơn Polling nhưng vẫn giữ kết nối chờ, tiêu tốn thread và bộ nhớ server.</li>
<li><strong>SSE</strong>: Tuyệt vời cho thông báo một chiều (Server -&gt; Client), dễ triển khai.</li>
<li><strong>WebSocket</strong>: Độ trễ thấp nhất (miligiây), giao tiếp hai chiều thực sự, tiết kiệm băng thông tối đa.</li>
</ul>
<p>Trong một thử nghiệm thực tế với 1000 người dùng, WebSocket chỉ có độ trễ <strong>50ms</strong> với việc sử dụng CPU dưới 10%, trong khi Polling có độ trễ <strong>1.2 giây</strong> và ngốn 45% CPU.</p>
<p>Nếu bạn đang xây dựng Chat, Game online, hay công cụ chỉnh sửa cộng tác (như Google Docs), <strong>WebSocket</strong> là lựa chọn bắt buộc. Còn nếu chỉ làm bảng tin chứng khoán hay thông báo đơn giản, <strong>SSE</strong> cũng là một lựa chọn không tồi. Hãy chọn công cụ phù hợp với bài toán của bạn!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/javascript/">JavaScript</a></li>
      <li><a href="http://localhost:1313/tags/socket.io/">Socket.io</a></li>
      <li><a href="http://localhost:1313/tags/real-time/">Real-Time</a></li>
      <li><a href="http://localhost:1313/tags/storytelling/">Storytelling</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/post-4-websocket/">
    <span class="title">« Prev</span>
    <br>
    <span>Chủ đề 4: WebSocket - Giao tiếp thời gian thực (Real-time)</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/js-fetch-axios/">
    <span class="title">Next »</span>
    <br>
    <span>Cuộc Chiến Giao Thức: Fetch API &#39;Cây Nhà Lá Vườn&#39; vs Axios &#39;Vũ Khí Hạng Nặng&#39;</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Khi Web Không Chỉ Là Tĩnh Lặng: Đánh Thức Sự Sống Với WebSockets on x"
            href="https://x.com/intent/tweet/?text=Khi%20Web%20Kh%c3%b4ng%20Ch%e1%bb%89%20L%c3%a0%20T%c4%a9nh%20L%e1%ba%b7ng%3a%20%c4%90%c3%a1nh%20Th%e1%bb%a9c%20S%e1%bb%b1%20S%e1%bb%91ng%20V%e1%bb%9bi%20WebSockets&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjs-websockets%2f&amp;hashtags=JavaScript%2cSocket.io%2cReal-time%2cStorytelling">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Khi Web Không Chỉ Là Tĩnh Lặng: Đánh Thức Sự Sống Với WebSockets on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjs-websockets%2f&amp;title=Khi%20Web%20Kh%c3%b4ng%20Ch%e1%bb%89%20L%c3%a0%20T%c4%a9nh%20L%e1%ba%b7ng%3a%20%c4%90%c3%a1nh%20Th%e1%bb%a9c%20S%e1%bb%b1%20S%e1%bb%91ng%20V%e1%bb%9bi%20WebSockets&amp;summary=Khi%20Web%20Kh%c3%b4ng%20Ch%e1%bb%89%20L%c3%a0%20T%c4%a9nh%20L%e1%ba%b7ng%3a%20%c4%90%c3%a1nh%20Th%e1%bb%a9c%20S%e1%bb%b1%20S%e1%bb%91ng%20V%e1%bb%9bi%20WebSockets&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fjs-websockets%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Khi Web Không Chỉ Là Tĩnh Lặng: Đánh Thức Sự Sống Với WebSockets on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjs-websockets%2f&title=Khi%20Web%20Kh%c3%b4ng%20Ch%e1%bb%89%20L%c3%a0%20T%c4%a9nh%20L%e1%ba%b7ng%3a%20%c4%90%c3%a1nh%20Th%e1%bb%a9c%20S%e1%bb%b1%20S%e1%bb%91ng%20V%e1%bb%9bi%20WebSockets">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Khi Web Không Chỉ Là Tĩnh Lặng: Đánh Thức Sự Sống Với WebSockets on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjs-websockets%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Khi Web Không Chỉ Là Tĩnh Lặng: Đánh Thức Sự Sống Với WebSockets on whatsapp"
            href="https://api.whatsapp.com/send?text=Khi%20Web%20Kh%c3%b4ng%20Ch%e1%bb%89%20L%c3%a0%20T%c4%a9nh%20L%e1%ba%b7ng%3a%20%c4%90%c3%a1nh%20Th%e1%bb%a9c%20S%e1%bb%b1%20S%e1%bb%91ng%20V%e1%bb%9bi%20WebSockets%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fjs-websockets%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Khi Web Không Chỉ Là Tĩnh Lặng: Đánh Thức Sự Sống Với WebSockets on telegram"
            href="https://telegram.me/share/url?text=Khi%20Web%20Kh%c3%b4ng%20Ch%e1%bb%89%20L%c3%a0%20T%c4%a9nh%20L%e1%ba%b7ng%3a%20%c4%90%c3%a1nh%20Th%e1%bb%a9c%20S%e1%bb%b1%20S%e1%bb%91ng%20V%e1%bb%9bi%20WebSockets&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fjs-websockets%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Khi Web Không Chỉ Là Tĩnh Lặng: Đánh Thức Sự Sống Với WebSockets on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Khi%20Web%20Kh%c3%b4ng%20Ch%e1%bb%89%20L%c3%a0%20T%c4%a9nh%20L%e1%ba%b7ng%3a%20%c4%90%c3%a1nh%20Th%e1%bb%a9c%20S%e1%bb%b1%20S%e1%bb%91ng%20V%e1%bb%9bi%20WebSockets&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fjs-websockets%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Blog của Hoàng Anh</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
